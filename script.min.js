document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".animated-element"),t=new IntersectionObserver((e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is-visible"),t.unobserve(e.target))})}),{threshold:.2});e.forEach(e=>{t.observe(e)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("href"),a=document.querySelector(t);a&&window.scrollTo({top:a.offsetTop-60,behavior:"smooth"})})});const a=document.querySelector(".navbar-brand");window.addEventListener("scroll",(()=>{window.scrollY>50?a.style.transform="scale(1.1)":a.style.transform="scale(1)"})),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(()=>{});const o=document.getElementById("chatbot-toggle"),n=document.getElementById("chatbot-window"),s=document.getElementById("chatbot-close"),i=document.getElementById("chatbot-send"),r=document.getElementById("chatbot-input"),c=document.getElementById("chatbot-messages"),d="https://automatizacion.dsinformatica.com.ar/webhook/dsibot";function l(e,t=!1){const a=document.createElement("div");a.className=`chat-message ${t?"user":"bot"}`,a.textContent=e,c.appendChild(a),c.scrollTop=c.scrollHeight}function u(){const e=document.createElement("div");e.className="chat-message bot",e.id="loading-indicator",e.innerHTML='<span>Escribiendo</span><span class="dots">...</span>',c.appendChild(e),c.scrollTop=c.scrollHeight}function m(){const e=document.getElementById("loading-indicator");e&&e.remove()}function u(){if(!document.getElementById("typing-animation-style")){const e=document.createElement("style");e.id="typing-animation-style",e.textContent="@keyframes typingDot{0%,60%,100%{transform:translateY(0);opacity:.6}30%{transform:translateY(-12px);opacity:1}}",document.head.appendChild(e)}const e=document.createElement("div");e.className="chat-message bot",e.id="loading-indicator",e.innerHTML='<div class="typing-indicator" style="display:flex;align-items:center;gap:6px;padding:10px 0;height:30px;"><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background-color:#0056b3;animation:typingDot 1.4s infinite ease-in-out;animation-delay:0s;"></span><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background-color:#0056b3;animation:typingDot 1.4s infinite ease-in-out;animation-delay:0.2s;"></span><span style="display:inline-block;width:10px;height:10px;border-radius:50%;background-color:#0056b3;animation:typingDot 1.4s infinite ease-in-out;animation-delay:0.4s;"></span></div>',c.appendChild(e),c.scrollTop=c.scrollHeight}async function h(e){if(document.getElementById("loading-indicator"))return void console.log("Ya hay una petición en curso, ignorando...");try{u(),console.log("Enviando mensaje al webhook:",d),console.log("Mensaje:",e);const t=new AbortController,a=setTimeout(()=>t.abort(),3e4),o=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e}),signal:t.signal});if(clearTimeout(a),console.log("Response status:",o.status),console.log("Response headers:",[...o.headers.entries()]),!o.ok){const e=await o.text();throw console.error("Error response:",e),new Error(`Error del servidor: ${o.status}`)}const n=o.headers.get("content-type");let s;if(n&&n.includes("application/json"))s=await o.json(),console.log("JSON response:",s);else{const e=await o.text();console.log("Text response:",e),s={response:e}}m();const i=s.response||s.message||s.text||s.reply||("string"==typeof s?s:"Lo siento, no pude procesar tu mensaje.");l(i,!1)}catch(e){if(m(),"AbortError"===e.name)console.error("La petición tardó demasiado y fue cancelada"),l("La petición tardó demasiado. Por favor, intenta nuevamente.",!1);else if(l("Lo siento, hubo un error al procesar tu mensaje. Por favor, intenta nuevamente.",!1),console.error("Error completo:",e),console.error("Error name:",e.name),console.error("Error message:",e.message),e instanceof TypeError)console.error("Posible error de CORS o red")}}function g(){const e=r.value.trim();e&&(l(e,!0),r.value="",h(e))}o&&o.addEventListener("click",()=>{n.classList.toggle("chatbot-hidden"),!n.classList.contains("chatbot-hidden")&&0===c.children.length&&l("¡Hola! Soy el asistente virtual de DSI. ¿En qué puedo ayudarte hoy?",!1)}),s&&s.addEventListener("click",()=>{n.classList.add("chatbot-hidden")}),i&&i.addEventListener("click",g),r&&r.addEventListener("keypress",e=>{"Enter"===e.key&&g()}),function(){var e=new Image;e.onload=function(){document.body.classList.add("webp-supported")},e.onerror=function(){},e.src="images/nuevo-logo-dsi-2025.webp"}()});